local Puffhub = {}

-- Services
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

-- Theme Presets
local Themes = {
    Vaporwave = {
        Background = Color3.fromRGB(35, 32, 60),
        Accent = Color3.fromRGB(255, 0, 191),
        TextColor = Color3.fromRGB(255, 255, 255)
    },
    Dark = {
        Background = Color3.fromRGB(25, 25, 25),
        Accent = Color3.fromRGB(100, 100, 255),
        TextColor = Color3.fromRGB(255, 255, 255)
    }
}

-- Create Window
function Puffhub:CreateWindow(config)
    local Name = config.Name or "Puffhub UI"
    local Theme = Themes[config.Theme] or Themes.Dark
    local ShowLoading = config.LoadingScreen
    local LoadingTitle = config.LoadingTitle or "Loading..."
    local LoadingSubtitle = config.LoadingSubtitle or "Please wait"
    local OpenKey = config.Keybind or Enum.KeyCode.LeftControl

    -- ScreenGui
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "PuffhubUI"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.IgnoreGuiInset = true
    ScreenGui.Parent = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")

    -- Main Frame
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 500, 0, 320)
    MainFrame.Position = UDim2.new(0.5, -250, 0.5, -160)
    MainFrame.BackgroundColor3 = Theme.Background
    MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    MainFrame.Visible = not ShowLoading
    MainFrame.ClipsDescendants = true
    MainFrame.Active = true
    MainFrame.Draggable = false
    MainFrame.Parent = ScreenGui

    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = MainFrame

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 0, 40)
    Title.BackgroundTransparency = 1
    Title.Text = Name
    Title.TextColor3 = Theme.TextColor
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 24
    Title.Parent = MainFrame

    -- Draggable Logic
    local dragging, dragInput, dragStart, startPos = false
    MainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    MainFrame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)

    -- Loading Screen
    if ShowLoading then
        local LoadingFrame = Instance.new("Frame")
        LoadingFrame.Size = MainFrame.Size
        LoadingFrame.Position = MainFrame.Position
        LoadingFrame.AnchorPoint = MainFrame.AnchorPoint
        LoadingFrame.BackgroundColor3 = Theme.Accent
        LoadingFrame.Parent = ScreenGui

        local LoadingText = Instance.new("TextLabel")
        LoadingText.Size = UDim2.new(1, 0, 0.5, 0)
        LoadingText.Position = UDim2.new(0, 0, 0, 20)
        LoadingText.BackgroundTransparency = 1
        LoadingText.Text = LoadingTitle
        LoadingText.TextColor3 = Theme.TextColor
        LoadingText.Font = Enum.Font.GothamBold
        LoadingText.TextSize = 28
        LoadingText.Parent = LoadingFrame

        local Subtitle = Instance.new("TextLabel")
        Subtitle.Size = UDim2.new(1, 0, 0.5, 0)
        Subtitle.Position = UDim2.new(0, 0, 0, 60)
        Subtitle.BackgroundTransparency = 1
        Subtitle.Text = LoadingSubtitle
        Subtitle.TextColor3 = Theme.TextColor
        Subtitle.Font = Enum.Font.Gotham
        Subtitle.TextSize = 18
        Subtitle.Parent = LoadingFrame

        task.delay(2.5, function()
            LoadingFrame:Destroy()
            MainFrame.Visible = true
        end)
    end

    -- Open / Close Keybind
    UserInputService.InputBegan:Connect(function(input, gpe)
        if gpe then return end
        if input.KeyCode == OpenKey then
            MainFrame.Visible = not MainFrame.Visible
        end
    end)

    local WindowObject = {}

    function WindowObject:CreateTab(tabName)
        -- Placeholder for Tab system
        warn("Tab system not implemented yet. Tab Name: " .. tabName)
    end

    return WindowObject
end

return Puffhub
